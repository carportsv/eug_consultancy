<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Management - Admin Dashboard</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    <link rel="stylesheet" href="drivers.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Config -->
    <script src="../../js/config.js"></script>
    <script src="../../js/auth.js"></script>
    
</head>
<body>
    <div class="admin-container drivers">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen hidden">
        <div class="loading-spinner"></div>
        <p>Cargando...</p>
    </div>

        <!-- Header -->
        <div class="admin-header">
            <div class="admin-header-content">
                <button class="back-btn" onclick="goBack()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Volver al Home
                </button>
                <i class="fas fa-users admin-header-icon"></i>
                <div class="admin-title">Gesti√≥n de Conductores</div>
            </div>
            <div class="admin-subtitle">Administra y supervisa todos los conductores del sistema</div>
        </div>

    <!-- Main Content -->
    <main class="admin-main" style="padding: 0.5rem 0.5rem !important; max-width: 98vw !important; margin: 0 auto !important; overflow: visible !important; height: auto !important; visibility: visible !important; opacity: 1 !important; display: block !important;">
        <!-- Driver Management Screen -->
        <div id="driverManagementScreen" class="management-screen" style="background: #ffffff !important; border-radius: 20px !important; padding: 1rem !important; margin-top: 0.25rem !important; border: 1px solid #e2e8f0 !important; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important; visibility: visible !important; opacity: 1 !important; display: block !important; overflow: visible !important; position: relative !important; z-index: 1 !important; max-width: 98vw !important; margin-left: auto !important; margin-right: auto !important;">
                         <!-- Stats Dashboard -->
             <div class="stats-dashboard" style="margin-top: 0px; margin-bottom: 20px;">
                 <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr) !important; gap: 1rem !important;">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalDrivers">0</h3>
                            <p>Total Drivers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeDriversCount">0</h3>
                            <p>Active Drivers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="availableDrivers">0</h3>
                            <p>Available Drivers</p>
                        </div>
                    </div>
                </div>
            </div>

                         <!-- Actions Bar -->
             <div class="actions-bar" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px;">
                 <div class="search-filters" style="display: flex; gap: 15px; align-items: center; flex: 1; flex-wrap: nowrap;">
                     <input type="text" id="driverSearch" placeholder="Search drivers..." onkeyup="if(window.driverService) driverService.filterDrivers()" style="flex: 1; min-width: 200px; max-width: 300px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #ffffff; color: #1f2937;">
                     <select id="driverStatusFilter" onchange="if(window.driverService) driverService.filterDrivers()" style="min-width: 120px; max-width: 150px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #ffffff; color: #1f2937;">
                         <option value="">All Status</option>
                         <option value="active">Active</option>
                         <option value="inactive">Inactive</option>
                     </select>
                     <select id="driverAvailabilityFilter" onchange="if(window.driverService) driverService.filterDrivers()" style="min-width: 120px; max-width: 150px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 4px; background: #ffffff; color: #1f2937;">
                         <option value="">All Availability</option>
                         <option value="available">Available</option>
                         <option value="unavailable">Unavailable</option>
                     </select>
                 </div>
                 <button class="btn btn-primary btn-large" onclick="if(window.driverService) driverService.showCreateDriverModal()" style="margin-left: 20px; white-space: nowrap;">
                     <i class="fas fa-plus"></i>
                     Add Driver
                 </button>
                 
             </div>

            <!-- Drivers Table -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Driver</th>
                            <th>License</th>
                            <th>Vehicle</th>
                            <th>Status</th>
                            <th>Availability</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="driversTableBody">
                        <!-- Drivers will be loaded dynamically here -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button id="prevDriverPage" class="btn btn-secondary" onclick="if(window.driverService) driverService.previousDriverPage()">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <span id="driverPageInfo">Page 1 of 1</span>
                <button id="nextDriverPage" class="btn btn-secondary" onclick="if(window.driverService) driverService.nextDriverPage()">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- Driver Modals -->
    
    <!-- Create Driver Modal -->
    <div id="createDriverModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Add New Driver</h2>
                <button class="modal-close" onclick="if(window.driverService) driverService.closeCreateDriverModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createDriverForm" onsubmit="if(window.driverService) driverService.createDriver(event)">
                <div class="form-group">
                    <label for="driverName">Driver Name *</label>
                    <input type="text" id="driverName" required>
                </div>
                <div class="form-group">
                    <label for="driverEmail">Email (optional)</label>
                    <input type="email" id="driverEmail">
                </div>
                <div class="form-group">
                    <label for="driverPhone">Phone (optional)</label>
                    <input type="tel" id="driverPhone">
                </div>
                <div class="form-group">
                    <label for="driverLicense">License Number *</label>
                    <input type="text" id="driverLicense" required>
                </div>
                <div class="form-group">
                    <label for="driverPlate">Vehicle Plate *</label>
                    <input type="text" id="driverPlate" required>
                </div>
                <div class="form-group">
                    <label for="driverVehicleMake">Vehicle Make *</label>
                    <input type="text" id="driverVehicleMake" required>
                </div>
                <div class="form-group">
                    <label for="driverVehicleModel">Vehicle Model *</label>
                    <input type="text" id="driverVehicleModel" required>
                </div>
                <div class="form-group">
                    <label for="driverVehicleColor">Vehicle Color *</label>
                    <input type="text" id="driverVehicleColor" required>
                </div>
                <div class="form-group">
                    <label for="driverStatus">Status</label>
                    <select id="driverStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="driverNotes">Additional Notes</label>
                    <textarea id="driverNotes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="if(window.driverService) driverService.closeCreateDriverModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Create Driver
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Driver Modal -->
    <div id="editDriverModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Driver</h2>
                <button class="modal-close" onclick="if(window.driverService) driverService.closeEditDriverModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editDriverForm" onsubmit="if(window.driverService) driverService.updateDriver(event)">
                <input type="hidden" id="editDriverId">
                <div class="form-group">
                    <label for="editDriverName">Driver Name *</label>
                    <input type="text" id="editDriverName" required>
                </div>
                <div class="form-group">
                    <label for="editDriverEmail">Email (optional)</label>
                    <input type="email" id="editDriverEmail">
                </div>
                <div class="form-group">
                    <label for="editDriverPhone">Phone (optional)</label>
                    <input type="tel" id="editDriverPhone">
                </div>
                <div class="form-group">
                    <label for="editDriverLicense">License Number *</label>
                    <input type="text" id="editDriverLicense" required>
                </div>
                <div class="form-group">
                    <label for="editDriverPlate">Vehicle Plate *</label>
                    <input type="text" id="editDriverPlate" required>
                </div>
                <div class="form-group">
                    <label for="editDriverVehicleMake">Vehicle Make *</label>
                    <input type="text" id="editDriverVehicleMake" required>
                </div>
                <div class="form-group">
                    <label for="editDriverVehicleModel">Vehicle Model *</label>
                    <input type="text" id="editDriverVehicleModel" required>
                </div>
                <div class="form-group">
                    <label for="editDriverVehicleColor">Vehicle Color *</label>
                    <input type="text" id="editDriverVehicleColor" required>
                </div>
                <div class="form-group">
                    <label for="editDriverStatus">Status</label>
                    <select id="editDriverStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDriverNotes">Additional Notes</label>
                    <textarea id="editDriverNotes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="if(window.driverService) driverService.closeEditDriverModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Driver
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Driver Modal -->
    <div id="viewDriverModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-eye"></i> Driver Details</h2>
                <button class="modal-close" onclick="if(window.driverService) driverService.closeViewDriverModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="driver-details">
                <div class="detail-group">
                    <label>Name:</label>
                    <span id="viewDriverName">-</span>
                </div>
                <div class="detail-group">
                    <label>Email:</label>
                    <span id="viewDriverEmail">-</span>
                </div>
                <div class="detail-group">
                    <label>Phone:</label>
                    <span id="viewDriverPhone">-</span>
                </div>
                <div class="detail-group">
                    <label>License:</label>
                    <span id="viewDriverLicense">-</span>
                </div>
                <div class="detail-group">
                    <label>Vehicle:</label>
                    <span id="viewDriverVehicle">-</span>
                </div>
                <div class="detail-group">
                    <label>Status:</label>
                    <span id="viewDriverStatus">-</span>
                </div>
                <div class="detail-group">
                    <label>Availability:</label>
                    <span id="viewDriverAvailable">-</span>
                </div>
                <div class="detail-group">
                    <label>Completed Rides:</label>
                    <span id="viewDriverCompletedRides">-</span>
                </div>
                <div class="detail-group">
                    <label>Notes:</label>
                    <span id="viewDriverNotes">-</span>
                </div>
                <div class="detail-group">
                    <label>Created:</label>
                    <span id="viewDriverCreatedAt">-</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="if(window.driverService) driverService.closeViewDriverModal()">
                    Close
                </button>
                <button class="btn btn-primary" onclick="if(window.driverService) driverService.editDriverFromView()">
                    <i class="fas fa-edit"></i> Edit Driver
                </button>
            </div>
        </div>
    </div>

     
        <!-- Notifications -->
        <div id="notifications" class="notifications"></div>
    </div>

     <!-- JavaScript Files -->
     <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
     <script src="../../js/shared-utils.js"></script>
     <script src="../../js/admin.js"></script>
     <script src="drivers.js"></script>
    
    <!-- Funci√≥n global para volver al men√∫ principal del admin -->
    <script>
        // Exponer la funci√≥n goBack globalmente
        window.goBack = function() {
            console.log('üîô Volviendo al home del admin...');
            
            try {
                // Verificar si taxiApp est√° disponible
                if (window.taxiApp && typeof window.taxiApp.showAdminHome === 'function') {
                    console.log('‚úÖ Usando taxiApp.showAdminHome para ir al home del admin');
                    // Ir al home del admin (men√∫ principal con botones)
                    window.taxiApp.showAdminHome();
                } else if (window.taxiApp && typeof window.taxiApp.backToAdminMenu === 'function') {
                    console.log('‚úÖ Usando taxiApp.backToAdminMenu como alternativa');
                    // Usar la funci√≥n alternativa si existe
                    window.taxiApp.backToAdminMenu();
                } else {
                    // Fallback: redirigir al home
                    console.warn('‚ö†Ô∏è taxiApp no disponible, usando fallback');
                    window.location.href = '../auth/login.html';
                }
            } catch (error) {
                console.error('‚ùå Error en goBack:', error);
                // Fallback final
                window.location.href = '../auth/login.html';
            }
        };
        
        // Tambi√©n exponer como funci√≥n global directa
        function goBack() {
            window.goBack();
        }
        
        console.log('‚úÖ Funci√≥n goBack expuesta globalmente desde drivers.html');
    </script>
    
    <!-- Inicializaci√≥n del DriverService -->
    <script>
        // Inicializar DriverService cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöó Inicializando p√°gina de drivers...');
            
            try {
                // Crear instancia del DriverService
                window.driverService = new DriverService();
                
                // Inicializar el servicio
                await window.driverService.init();
                
                         console.log('‚úÖ P√°gina de drivers inicializada correctamente');
         
     } catch (error) {
         console.error('‚ùå Error inicializando p√°gina de drivers:', error);
     }
 });
 
   // Script adicional para forzar la visibilidad del header
  document.addEventListener('DOMContentLoaded', function() {
      console.log('üîß Forzando visibilidad del header...');
      
      // Forzar estilos del header
      const header = document.querySelector('.admin-header');
      if (header) {
          header.style.display = 'flex';
          header.style.visibility = 'visible';
          header.style.opacity = '1';
          header.style.overflow = 'visible';
          header.style.height = 'auto';
          header.style.transform = 'none';
          header.style.zIndex = '100';
          
          // ELIMINAR PSEUDOELEMENTOS PROBLEM√ÅTICOS
          const style = document.createElement('style');
          style.textContent = `
              .drivers-header::before,
              .drivers-header::after {
                  display: none !important;
                  content: none !important;
                  opacity: 0 !important;
                  pointer-events: none !important;
              }
              .drivers-header h1,
              .drivers-header h2,
              .drivers-header h3 {
                  -webkit-text-fill-color: white !important;
                  color: white !important;
                  background: none !important;
                  animation: none !important;
              }
          `;
          document.head.appendChild(style);
          
          console.log('‚úÖ Header forzado a ser visible');
      } else {
          console.error('‚ùå Header no encontrado');
      }
      
      // Forzar estilos del body
      document.body.style.overflow = 'visible';
      document.body.style.height = 'auto';
      document.body.style.minHeight = '100vh';
      
      // Forzar estilos del main
      const main = document.querySelector('.admin-main');
      if (main) {
          main.style.overflow = 'visible';
          main.style.height = 'auto';
          main.style.visibility = 'visible';
          main.style.opacity = '1';
          main.style.display = 'block';
      }
  });
    </script>
</body>
</html>
