<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gesti√≥n de Viajes | TaxiApp</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="ride-management.css">
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <div class="admin-header-content">
                <button class="back-btn" onclick="goBack()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <i class="fas fa-car admin-header-icon"></i>
                <div class="admin-title">Gesti√≥n de Viajes</div>
            </div>
            <div class="admin-subtitle">Administrar viajes y conductores</div>
        </div>

        <!-- Loading -->
        <div id="loadingScreen" class="loading-screen hidden">
            <div class="loading-spinner"></div>
            <p>Loading data...</p>
        </div>

        <!-- Main Content -->
        <main class="admin-main" id="mainContent" style="display: none;">
            <!-- Stats Dashboard - Clickable Navigation -->
            <section class="stats-dashboard">
                                 <div class="stats-grid">
                    <!-- Crear Viaje Card -->
                    <button class="stat-card create-ride-button" onclick="window.location.href='create/create-ride.html'">
                        <div class="stat-icon create-ride-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" fill="#2563EB"/>
                            </svg>
                        </div>
                        <div class="stat-content create-ride-content">
                            <h3>Crear Viaje</h3>
                        </div>
                    </button>
                     <button class="stat-card clickable" onclick="navigateToStatusPage('requested')">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="pendingGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ffd93d;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff6b6b;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="url(#pendingGradient)"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="pendingRidesCount">0</h3>
                            <p>Viajes Pendientes</p>
                            <small>Click para ver</small>
                        </div>
                    </button>

                    <button class="stat-card clickable" onclick="navigateToStatusPage('accepted')">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="activeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#4ecdc4;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#44a08d;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="url(#activeGradient)"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeRidesCount">0</h3>
                            <p>Viajes Aceptados</p>
                            <small>Click para ver</small>
                        </div>
                    </button>

                    <button class="stat-card clickable" onclick="navigateToStatusPage('in_progress')">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff9a56;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff6b6b;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M13 10V3L4 14h7v7l9-11h-7z" fill="url(#progressGradient)"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="progressRidesCount">0</h3>
                            <p>En Progreso</p>
                            <small>Click para ver</small>
                        </div>
                    </button>

                    <button class="stat-card clickable" onclick="navigateToStatusPage('completed')">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="completedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#4ecdc4;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#44a08d;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="url(#completedGradient)"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="completedRidesCount">0</h3>
                            <p>Completados</p>
                            <small>Click para ver</small>
                        </div>
                    </button>

                    <button class="stat-card clickable" onclick="navigateToStatusPage('cancelled')">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="cancelledGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ee5a24;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="url(#cancelledGradient)"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="cancelledRidesCount">0</h3>
                            <p>Cancelados</p>
                            <small>Click para ver</small>
                        </div>
                    </button>
                </div>
            </section>

            <!-- Pending Rides Section - Removed as stats cards are now clickable -->

            <!-- Navigation Buttons - Removed as stats cards are now clickable -->
        </main>

        <!-- Notifications -->
        <div id="notifications" class="notifications"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/shared-utils.js"></script>
    <script src="../js/admin.js"></script>
    <script src="ride-management.js"></script>
    
    <script>
        // Verificar autenticaci√≥n antes de cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç CONFIG disponible:', typeof CONFIG !== 'undefined');
            console.log('üîç CONFIG.STORAGE_KEYS disponible:', typeof CONFIG !== 'undefined' && typeof CONFIG.STORAGE_KEYS !== 'undefined');
            
            if (typeof CONFIG === 'undefined' || typeof CONFIG.STORAGE_KEYS === 'undefined') {
                console.log('‚ùå CONFIG no disponible, esperando...');
                setTimeout(() => {
                    const userData = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_DATA);
                    const userToken = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_TOKEN);
                    verifyAuth(userData, userToken);
                }, 100);
                return;
            }
            
            const userData = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_DATA);
            const userToken = localStorage.getItem(CONFIG.STORAGE_KEYS.USER_TOKEN);
            verifyAuth(userData, userToken);
        });
        
        function verifyAuth(userData, userToken) {
            console.log('üîç Verificando autenticaci√≥n en ride-management...');
            console.log('üîç CONFIG.STORAGE_KEYS.USER_DATA:', CONFIG.STORAGE_KEYS.USER_DATA);
            console.log('üîç CONFIG.STORAGE_KEYS.USER_TOKEN:', CONFIG.STORAGE_KEYS.USER_TOKEN);
            console.log('üîç userData encontrado:', !!userData);
            console.log('üîç userToken encontrado:', !!userToken);
            console.log('üîç localStorage completo:', localStorage);
            
            if (!userData) {
                console.log('‚ùå Usuario no autenticado, redirigiendo al login...');
                window.location.href = '../auth/login.html';
                return;
            }
            
            console.log('‚úÖ Usuario autenticado en ride-management');
        }
    </script>
</body>
</html>
